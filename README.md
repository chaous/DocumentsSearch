# отчет: Проектирование ML-системы — Задание 10
### Курс Проектирование систем машинного обучения
### Студент: Илья Рожков Алексеевич
### Группа: МЛ-2025

# Введение и постановка задачи
Проектируется система для семантического поиска по внутренним корпоративным документам крупной организации.
Система должна обеспечивать быстрый и точный поиск по отчётам, презентациям, внутренним вики-страницам и другим источникам знаний, используя векторный поиск на основе заранее рассчитанных эмбеддингов документов.
Обработка запроса пользователя должна выполняться без обращения к тяжёлым генеративным моделям в режиме онлайн: используются компактные модели для получения эмбеддингов запросов и оптимизированный векторный индекс. Поиск должен учитывать сложную модель прав доступа, чтобы каждый пользователь видел только те документы, к которым у него есть разрешение.
Система должна работать под высокой нагрузкой и масштабироваться под большое количество пользователей в корпорации.



# Бизнес-цели
- 1. **Почти мгновенный доступ к информации**
Сократить среднее время поиска внутренних документов (регламентов, отчётов, презентаций, вики-страниц) с нескольких минут до **долей секунды** благодаря высокопроизводительному семантическому поиску с задержкой не более **417 мс**.
Это **повышает скорость принятия решений** и **снижает операционные задержки** в работе сотрудников.
- 2. **Улучшение релевантности результатов поиска**
Повысить точность и полезность выдачи за счёт использования мл поиска, чтобы сотрудники находили **нужные документы с первого запроса**.
Цель — уменьшить количество повторных запросов и повысить эффективность работы.
- 3. **Поддержка большого числа пользователей без деградации качества**
Обеспечить стабильную работу системы для **1,288,472 DAU** и **пиковых 16,994 RPS**, сохраняя высокую скорость и релевантность поиска.
Это снижает нагрузку на внутренние службы поддержки и повышает вовлечённость пользователей в использование корпоративного хранилища знаний.


**Требования к системе:**
- Задержка (latency) ответа не должна превышать **417 мс**.
- Система должна обслуживать **1,288,472 активных пользователей в день (DAU)**, с пиковой нагрузкой в **16,994 запросов в секунду (RPS)**.
- Система должна быть масштабируемой и отказоустойчивой.



# Часть 1: Формулировка ML-задачи и выбор модели
- **1. Определение ML-задачи**
Задачу можно сформулировать как задачу ранжирования документов (Learning-to-Rank) в рамках семантического поиска.
Для каждого пользовательского запроса система должна упорядочить набор доступных пользователю документов по степени их релевантности.
Поиск выполняется с учётом семантического сходства между запросом и документами, а также ограничений доступа (пользователь может видеть только разрешённые документы).


## Входные данные:
Текстовый запрос пользователя на естественном языке.
Корпус внутренних документов (отчёты, презентации, вики), представленных в виде текстовых фрагментов.
Метаданные документов:
идентификаторы проектов и команд;
информация о правах доступа (ACL / RBAC);
тип документа, дата создания и версия.
Выходные данные:
Упорядоченный список документов (или фрагментов документов), релевантных запросу пользователя.
Для каждого документа — числовой скор релевантности.


## Целевая переменная:
Целевой переменной является оценка релевантности документа запросу.
В явном виде она может отсутствовать, поэтому используется одна из следующих форм:
- Неявная обратная связь пользователей:
- клики по результатам поиска;
- время просмотра документа;
- повторные запросы.
## Слабая разметка:
- бинарная метка релевантности (релевантен / нерелевантен);
- порядковая оценка (например, 0 — нерелевантен, 1 — частично релевантен, 2 — релевантен).
## Прокси-таргет:
- Семантическое сходство между эмбеддингом запроса и эмбеддингом документа, используемое как обучающий сигнал.
- Таким образом, задача не предполагает существование «идеального ответа», а оптимизируется по метрикам качества ранжирования (Precision@k, recal@K).



# 2. Выбор модели
Рассмотрим два подхода к построению системы семантического поиска по внутренним корпоративным документам.
## Подход 1: Прямой семантический поиск по эмбеддингам (Vector Similarity Search)
В данном подходе каждый документ и пользовательский запрос представляются в виде векторных эмбеддингов, полученных с помощью компактной нейросетевой модели.
Поиск осуществляется путём вычисления близости между эмбеддингом запроса и эмбеддингами документов с использованием приближённого поиска ближайших соседей (Approximate Nearest Neighbors).
### Преимущества:
- Очень высокая скорость поиска, что позволяет уложиться в ограничение по задержке 417 мс.
- Простая и хорошо масштабируемая архитектура.
- Возможность предварительного вычисления эмбеддингов документов оффлайн.
- Минимальные вычислительные затраты в режиме онлайн.
### Недостатки:
- Релевантность определяется только локальным сходством запроса и документа.
- Не учитываются глобальные связи между документами (темы, контекст, совместное использование).
- Сложно улучшать качество без увеличения размерности эмбеддингов или сложности модели.
## Подход 2: Семантический поиск с использованием графа документов на основе эмбеддингов
В данном подходе документы представляются в виде вершин графа, а рёбра формируются оффлайн на основе семантической близости их эмбеддингов (например, по k-ближайшим соседям).
Граф документов строится заранее на этапе подготовки данных и отражает семантические связи между документами.
В процессе поиска выполняется быстрый векторный retrieval для получения начального набора кандидатов, после чего используется навигация по предварительно построенному графу документов для уточнения и дополнения списка релевантных результатов.
### Преимущества:
- Более высокая релевантность за счёт учёта глобальной структуры корпуса документов.
- Возможность находить связанные документы, которые не являются ближайшими по векторному сходству.
- Улучшение качества поиска без использования тяжёлых моделей в режиме онлайн.
- Возможность объяснять результаты поиска через связи в графе.
- Навигация по графу позволяет ограничить пространство поиска и сократить количество проверяемых документов по сравнению с полным перебором.
### Недостатки:
- Более сложная оффлайн-подготовка данных (построение и обновление графа).
- Дополнительные затраты памяти на хранение графовой структуры.
- Усложнение логики поиска по сравнению с прямым ANN.
## Выбор модели
Для данной задачи выбирается семантический поиск с использованием графа документов, построенного на основе эмбеддингов.
Несмотря на более сложную подготовку данных, данный подход позволяет существенно повысить релевантность результатов поиска, сохранив при этом высокую скорость работы.
Отсутствие тяжёлых моделей в режиме онлайн и возможность параллельной обработки запросов позволяют надёжно уложиться в требование по задержке 417 мс и обеспечить масштабируемость системы при высокой нагрузке.